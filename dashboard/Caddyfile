# Caddyfile for local HTTPS
{
    # Enable automatic HTTPS with self-signed certificates for local use
    auto_https on
    # Skip domain validation for local IPs
    skip_install_trust
}

https://192.168.0.86 {
    # Serve static files from /srv
    root * /srv
    file_server

    # Handle SPA routing - fallback to index.html for client-side routing
    try_files {path} /index.html

    # TLS for local IP (self-signed)
    tls internal

    # Security headers (relaxed for local dev)
    header {
        X-Content-Type-Options "nosniff"
        X-Frame-Options "SAMEORIGIN"
        Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data:; connect-src 'self' http://192.168.0.86:8001 ws://192.168.0.86:8001"
    }

    # Compression
    encode gzip
}

# Redirect HTTP to HTTPS
http://192.168.0.86 {
    redir https://192.168.0.86{uri}
}
